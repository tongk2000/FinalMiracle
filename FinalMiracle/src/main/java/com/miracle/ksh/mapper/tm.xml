<?xml version="1.0" encoding="UTF-8"?>

<!-- ==== #7. mapper 기본설정 ==== -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- ==== #8. 루트 엘리먼트 & 네임스페이스 설정(프로젝트 전체내에서 유일해야 한다.) ==== -->              
<mapper namespace="kshTM">

	<resultMap type="java.util.HashMap" id="tmListMap">
		<result property="RNO" 				column="rno" 			javaType="String" />
 		<result property="IDX" 			column="idx" 			javaType="String" />
 		<result property="USERID" 			column="userid" 			javaType="String" />
 		<result property="NAME" 			column="name" 		javaType="String" />
 		<result property="REGDATE" 			column="regdate" 			javaType="String" />
 		<result property="PROFILE" 	column="profile" 	javaType="String" />
 		<result property="IMG" 			column="img" 			javaType="String" />
 		<result property="STATUS" 	column="status" 	javaType="String" />
	</resultMap>
	<select id="tmList1" parameterType="HashMap" resultMap="tmListMap">
		select rno, idx, userid, name, regdate, profile, img, status
		from view_memberlist
		where idx = 1
	</select>
	
	<select id="tmList2" parameterType="HashMap" resultMap="tmListMap">
		select rno, idx, userid, name, regdate, profile, img, status
		from view_memberlist
		where idx = 1
		and ${colname} like '%'|| #{search} ||'%'
	</select>
	
	
	<select id="TMTotalCount1" parameterType="HashMap" resultType="int">
		select count(*)
		from view_memberlist
		where idx = 1
	</select>
	
	
	<select id="TMTotalCount2" parameterType="HashMap" resultType="int">
		select count(*)
		from view_memberlist
		where idx = 1
		and ${colname} like '%'|| #{search} ||'%'
	</select>
	
	
	<resultMap type="java.util.HashMap" id="teamListMap">
		<result property="IDX" 				column="idx" 			javaType="String" />
 		<result property="NAME" 			column="name" 			javaType="String" />
	</resultMap>
	<select id="getTeamList1" parameterType="String" resultMap="teamListMap">
		select A.idx, A.name
		from tbl_team A join tbl_member B
		on A.fk_member_idx = B.idx
		where A.fk_member_idx = #{fk_member_idx}
		order by A.idx desc
	</select>
	
	<select id="getTeamList2" parameterType="String" resultMap="teamListMap">
		select C.idx, C.name
		from tbl_member A join tbl_teamwon B
		on A.idx = B.fk_member_idx join tbl_team C
		on B.fk_team_idx = C.idx
		where B.fk_member_idx = #{fk_member_idx}
		and B.status = 1
		order by C.idx desc
	</select>
	
	
	<insert id="TeamCreate" parameterType="String">
		insert into tbl_team
		values(seq_team.nextval, #{fk_member_idx}, #{name}, #{tel1}, #{tel2}, #{tel3}, #{post1}, #{post2}, #{addr1}, #{addr2}, 'default.jpg', default, null, 1)
	</insert>

</mapper>